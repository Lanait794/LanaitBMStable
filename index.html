<!DOCTYPE html>
<html lang="ja">

<head>
    <title>Lanait難易度表</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="bmstable" content="header.json" />
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
</head>

<body>
    <header class="mb-3">
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">Lanait難易度表</span>
            </div>
        </nav>
    </header>

    <div class="container">

        <div class="alert alert-success mb-3" role="alert">
            <p>Lanaitの譜面とLanaitの曲で作ってもらった譜面まとめ。</p>
            <p>レベルはSatellite基準。Stella以上は13表記です。</p>
            <hr>
            <p class="mb-0">何かあればLanaitのTwitter(@Lanait_)まで。</p>
        </div>

        <!--ここから難易度表本体-->
        <div>
            <table class="table table-light table-striped table-hover" id="table_int"></table>
        </div>

        <script type="text/javascript">
            $(document).ready(function () {
                $.getJSON($("meta[name=bmstable]").attr("content"), function (header) {
                    $.getJSON(header.data_url, function (information) {
                        makeBMSTable(information, header.symbol);
                    });
                });
            });

            function esc(s) {
                return (s == null ? "" : String(s))
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;");
            }

            function linkCell(url, text) {
                if (!url) return "";
                return "<a href='" + esc(url) + "' target='_blank' rel='noopener'>" + text + "</a>";
            }

            function makeBMSTable(info, mark) {
                var obj = $("#table_int");
                obj.html("");
                $("<thead class='table-dark'><tr>"
                    + "<th>Level</th><th>Title</th><th>作曲者</th><th>譜面作者</th>"
                    + "<th>BPM</th><th>T/N</th><th>Comment</th><th>本体</th><th>差分</th>"
                    + "</tr></thead><tbody>").appendTo(obj);

                var x = "", count = 0, sep = null;

                for (var i = 0; i < info.length; i++) {
                    var level = info[i].level;
                    if (x != level) {
                        if (sep != null) {
                            sep.html("<td colspan='9'><b>" + mark + x + " (" + count + "譜面)</b></td>");
                        }
                        sep = $("<tr class='table-dark' style='text-align:center' id='" + mark + level + "'></tr>");
                        sep.appendTo(obj);
                        count = 0;
                        x = level;
                    }

                    var titleCell = info[i].md5
                        ? "<a href='http://www.dream-pro.info/~lavalse/LR2IR/search.cgi?mode=ranking&bmsmd5="
                          + esc(info[i].md5) + "' target='_blank'>" + esc(info[i].title) + "</a>"
                        : esc(info[i].title);

                    var tr = $("<tr></tr>");
                    tr.append("<td width='5%'>" + esc(mark + level) + "</td>");
                    tr.append("<td width='25%'>" + titleCell + "</td>");
                    tr.append("<td width='12%'>" + esc(info[i]["作曲者"]) + "</td>");
                    tr.append("<td width='12%'>" + esc(info[i]["譜面作者"]) + "</td>");
                    tr.append("<td width='7%'>" + esc(info[i]["BPM"]) + "</td>");
                    tr.append("<td width='6%'>" + esc(info[i]["T/N"]) + "</td>");
                    tr.append("<td width='20%'>" + esc(info[i].comment) + "</td>");
                    tr.append("<td width='6%'>" + linkCell(info[i]["本体"], "本体") + "</td>");
                    tr.append("<td width='6%'>" + linkCell(info[i]["差分"], "差分") + "</td>");
                    tr.appendTo(obj);

                    count++;
                }

                if (sep != null) {
                    sep.html("<td class='table-dark' style='text-align:center' colspan='9'><b>" + mark + x
                        + " (" + count + "譜面)</b></td>");
                }

                $("</tbody>").appendTo(obj);
            }
        </script>
    </div>
</body>
</html>
